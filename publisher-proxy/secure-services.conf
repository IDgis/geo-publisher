<VirtualHost *:443>
	ServerName ${DOMAIN_PREFIX}secure-services${DOMAIN_SUFFIX}
	
	SSLEngine on
	SSLCertificateFile	/etc/ssl/certs/ssl-cert-snakeoil.pem
	SSLCertificateKeyFile	/etc/ssl/private/ssl-cert-snakeoil.key
	
	# only allow traffic from trusted or internal networks
	<If "! ( ( ${TRUSTED_EXPR} ) || ( ${INTERNAL_EXPR} ) )">
		Deny from all
	</If>
	
	ProxyPass "/geoserver" "http://geoserver_secure:8080/geoserver" disablereuse=On retry=1
	ProxyPassReverse "/geoserver" "http://geoserver_secure:8080/geoserver"
	
	ProxyPass "/viewer" "http://viewer_secure:9000/viewer" disablereuse=On retry=1
	ProxyPassReverse "/viewer" "http://viewer_secure:9000/viewer"
</VirtualHost>

<VirtualHost *:80>
	ServerName ${DOMAIN_PREFIX}secure-services${DOMAIN_SUFFIX}

	RewriteEngine On
	RewriteRule (.*) https://%{SERVER_NAME}$1 [R,L]	
</VirtualHost>