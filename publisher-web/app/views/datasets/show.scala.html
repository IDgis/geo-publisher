@(dataset: nl.idgis.publisher.domain.web.Dataset, diffs: List[nl.idgis.publisher.domain.service.ColumnDiff])

@import nl.idgis.publisher.domain.web._
@import nl.idgis.publisher.domain.job.ConfirmNotificationResult
@import nl.idgis.publisher.domain.job.load.ImportNotificationProperties
@import nl.idgis.publisher.domain.service.ColumnDiffOperation

@categoryRefLink(cat: Category, cls: String = null) = {
	<a href="@routes.Datasets.listByCategory(cat.id)"@if(cls != null){ class="@cls"}>@cat.name</a>
}

@layout.application(
	title = "Dataset - " + dataset.name
) {
	<div class="page-content">
		<h1 class="page-header">Dataset @dataset.name</h1>
		
		<div class="row">
			<div class="col-lg-6">
				<div class="panel panel-default">
					<div class="panel-heading">
						Overzicht
					</div>
					<table class="table">
						<tbody>
							<tr>
								<th>Naam</th>
								<td>@dataset.name</td>
							</tr>
							<tr>
								<th>Tabelnaam</th>
								<td>@dataset.id</td>
							</tr>
							<tr>
								<th>Brondataset</th>
								<td>@dataset.sourceDataset.name</td>
							</tr>
							<tr>
								<th>Status</th>
								<td>@helper.status(dataset.currentStatus, true)</td>
							</tr>
							<tr>
								<th>Categorie</th>
								<td>@categoryRefLink(dataset.category, "")</td>
							</tr>
							<tr>
								<th>Heeft filtercondities</th>
								<td>@if(dataset.filterConditions.getExpression() != null){ ja } else { nee }</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			@if(!dataset.activeNotifications.isEmpty) {
			<div class="col-lg-6">
				@for(notification <- dataset.activeNotifications) {
				<form method="POST" action="@routes.Datasets.setNotificationResult(dataset.id, notification.id)" class="panel @if(notification.message.properties.asInstanceOf[ImportNotificationProperties].getResult().equals(ConfirmNotificationResult.NOT_OK)){panel-default}else{panel-info}">
					<div class="panel-heading">
						Structuurwijziging
						@if(notification.message.properties.asInstanceOf[ImportNotificationProperties].getResult().equals(ConfirmNotificationResult.NOT_OK)) {
							(verworpen)
						}
					</div>
					<div class="panel-body">
						Wijzigingen in kolommen:
					</div>
					<table class="table">
						<tbody>
							@for(diff <- diffs) {
								<tr>
									<th>@diff.getColumn().getName()</th>
									<td>@diff.getColumn().getDataType().name</td>
									<td>
										@if(diff.getOperation().equals(ColumnDiffOperation.ADD)) {
											Toegevoegd
										} else {
											Verwijderd
										}
									</td>
								</tr>
							}
						</tbody>
					</table>
					<div class="panel-footer">
						@if(!notification.message.properties.asInstanceOf[ImportNotificationProperties].getResult().equals(ConfirmNotificationResult.NOT_OK)) {
							<button type="submit" class="btn btn-default" name="result" value="@ConfirmNotificationResult.NOT_OK.name">Verwerpen</button>
						}
						<button type="submit" class="btn btn-primary" name="result" value="@ConfirmNotificationResult.OK.name">Toepassen</button>
					</div>
				</form>
				}
			</div>
			}
		</div>
	</div>
}